

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>discord.ext.commands.core &mdash; Red - Discord Bot 3.5.14.dev2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=7ab3649f" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=629867fc"></script>
      <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Red - Discord Bot
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation Guides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install_guides/index.html">Installing Red</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bot_application_guide.html">Creating a bot account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../update_red.html">Updating Red</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about_venv.html">About Virtual Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../autostart_windows.html">Setting up auto-restart using batch on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../autostart_mac.html">Setting up auto-restart on Mac</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../autostart_systemd.html">Setting up auto-restart using systemd on Linux</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cog Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_customcom.html">CustomCommands Cog Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_permissions.html">Permissions Cog Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide_trivia_list_creation.html">Trivia List Creation Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../intents.html">About (privileged) intents and public bots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/admin.html">Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/alias.html">Alias</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/audio.html">Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/cleanup.html">Cleanup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/cog_manager_ui.html">Cog Manager UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/customcommands.html">CustomCommands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/dev.html">Dev</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/downloader.html">Downloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/economy.html">Economy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/filter.html">Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/image.html">Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/permissions.html">Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/mod.html">Mod</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/modlog.html">ModLog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/mutes.html">Mutes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/reports.html">Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/streams.html">Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/trivia.html">Trivia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cog_guides/warnings.html">Warnings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../red_core_data_statement.html">Red and End User Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Red Development Framework Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide_migration.html">Migrating cogs from Red V2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide_cog_creation.html">Creating cogs for Red V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide_slash_and_interactions.html">Slash Commands and Interactions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide_publish_cogs.html">Publishing cogs for Red V3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guide_cog_creators.html">Becoming an Approved Cog Creator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_apikeys.html">Shared API Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_bank.html">Bank</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_bot.html">Bot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_checks.html">Command Check Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_commands.html">Commands Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_app_commands.html">App Commands Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_config.html">Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_datamanager.html">Data Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_events.html">Custom Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_i18n.html">Internationalization Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_modlog.html">Mod log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_rpc.html">RPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_tree.html">Tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../framework_utils.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../version_guarantees.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../version_guarantees.html#end-user-guarantees">End-user Guarantees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../version_guarantees.html#developer-guarantees">Developer Guarantees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../version_guarantees.html#breaking-change-notices">Breaking Change Notices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../incompatible_changes/index.html">Backward incompatible changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../host-list.html">Hosting Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Red - Discord Bot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">discord.ext.commands.core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">


           <div itemprop="articleBody">
             
  <h1>Source code for discord.ext.commands.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The MIT License (MIT)</span>

<span class="sd">Copyright (c) 2015-present Rapptz</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="sd">copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="sd">to deal in the Software without restriction, including without limitation</span>
<span class="sd">the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="sd">and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="sd">Software is furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in</span>
<span class="sd">all copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="sd">OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="sd">FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="sd">DEALINGS IN THE SOFTWARE.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Generator</span><span class="p">,</span>
    <span class="n">Generic</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Literal</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">Type</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">overload</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">discord</span>

<span class="kn">from</span> <span class="nn">._types</span> <span class="kn">import</span> <span class="n">_BaseCommand</span><span class="p">,</span> <span class="n">CogT</span>
<span class="kn">from</span> <span class="nn">.cog</span> <span class="kn">import</span> <span class="n">Cog</span>
<span class="kn">from</span> <span class="nn">.context</span> <span class="kn">import</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">.converter</span> <span class="kn">import</span> <span class="n">Greedy</span><span class="p">,</span> <span class="n">run_converters</span>
<span class="kn">from</span> <span class="nn">.cooldowns</span> <span class="kn">import</span> <span class="n">BucketType</span><span class="p">,</span> <span class="n">Cooldown</span><span class="p">,</span> <span class="n">CooldownMapping</span><span class="p">,</span> <span class="n">DynamicCooldownMapping</span><span class="p">,</span> <span class="n">MaxConcurrency</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.parameters</span> <span class="kn">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">Signature</span>
<span class="kn">from</span> <span class="nn">discord.app_commands.commands</span> <span class="kn">import</span> <span class="n">NUMPY_DOCSTRING_ARG_REGEX</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Concatenate</span><span class="p">,</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">Self</span>

    <span class="kn">from</span> <span class="nn">._types</span> <span class="kn">import</span> <span class="n">BotT</span><span class="p">,</span> <span class="n">Check</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">Coro</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">,</span> <span class="n">Error</span><span class="p">,</span> <span class="n">Hook</span><span class="p">,</span> <span class="n">UserCheck</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;Command&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Group&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GroupMixin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;command&#39;</span><span class="p">,</span>
    <span class="s1">&#39;group&#39;</span><span class="p">,</span>
    <span class="s1">&#39;has_role&#39;</span><span class="p">,</span>
    <span class="s1">&#39;has_permissions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;has_any_role&#39;</span><span class="p">,</span>
    <span class="s1">&#39;check&#39;</span><span class="p">,</span>
    <span class="s1">&#39;check_any&#39;</span><span class="p">,</span>
    <span class="s1">&#39;before_invoke&#39;</span><span class="p">,</span>
    <span class="s1">&#39;after_invoke&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bot_has_role&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bot_has_permissions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bot_has_any_role&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cooldown&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dynamic_cooldown&#39;</span><span class="p">,</span>
    <span class="s1">&#39;max_concurrency&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dm_only&#39;</span><span class="p">,</span>
    <span class="s1">&#39;guild_only&#39;</span><span class="p">,</span>
    <span class="s1">&#39;is_owner&#39;</span><span class="p">,</span>
    <span class="s1">&#39;is_nsfw&#39;</span><span class="p">,</span>
    <span class="s1">&#39;has_guild_permissions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bot_has_guild_permissions&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">MISSING</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">MISSING</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">CommandT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;CommandT&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Command[Any, ..., Any]&#39;</span><span class="p">)</span>
<span class="c1"># CHT = TypeVar(&#39;CHT&#39;, bound=&#39;Check&#39;)</span>
<span class="n">GroupT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;GroupT&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Group[Any, ..., Any]&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unwrap_function</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">partial</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="s1">&#39;__wrapped__&#39;</span><span class="p">):</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">__wrapped__</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">partial</span><span class="p">):</span>
            <span class="n">function</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">func</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">function</span>


<span class="k">def</span> <span class="nf">get_signature_parameters</span><span class="p">(</span>
    <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">globalns</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">skip_parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]:</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">Signature</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">eval_annotation</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">evaluate_annotation</span>
    <span class="n">required_params</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_inside_class</span><span class="p">(</span><span class="n">function</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">skip_parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">skip_parameters</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">required_params</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Command signature requires at least </span><span class="si">{</span><span class="n">required_params</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1"> parameter(s)&#39;</span><span class="p">)</span>

    <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">required_params</span><span class="p">):</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">default</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">):</span>  <span class="c1"># update from the default</span>
            <span class="k">if</span> <span class="n">default</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># There are a few cases to care about here.</span>
                <span class="c1"># x: TextChannel = commands.CurrentChannel</span>
                <span class="c1"># x = commands.CurrentChannel</span>
                <span class="c1"># In both of these cases, the default parameter has an explicit annotation</span>
                <span class="c1"># but in the second case it&#39;s only used as the fallback.</span>
                <span class="k">if</span> <span class="n">default</span><span class="o">.</span><span class="n">_fallback</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">is</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">parameter</span><span class="o">.</span><span class="n">_annotation</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">annotation</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameter</span><span class="o">.</span><span class="n">_annotation</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">annotation</span>

            <span class="n">parameter</span><span class="o">.</span><span class="n">_default</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">default</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">_description</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">_displayed_default</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">_displayed_default</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">_displayed_name</span> <span class="o">=</span> <span class="n">default</span><span class="o">.</span><span class="n">_displayed_name</span>

        <span class="n">annotation</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">annotation</span>

        <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">annotation</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="n">annotation</span> <span class="o">=</span> <span class="n">eval_annotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">globalns</span><span class="p">,</span> <span class="n">globalns</span><span class="p">,</span> <span class="n">cache</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="n">Greedy</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unparameterized Greedy[...] is disallowed in signature.&#39;</span><span class="p">)</span>

        <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">annotation</span><span class="o">=</span><span class="n">annotation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">params</span>


<span class="n">PARAMETER_HEADING_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Parameters?\n---+\n&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_fold_text</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turns a single newline into a space, and multiple newlines into a newline.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">replacer</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n+&#39;</span><span class="p">,</span> <span class="n">replacer</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">extract_descriptions_from_docstring</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">docstring</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">docstring</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">divide</span> <span class="o">=</span> <span class="n">PARAMETER_HEADING_REGEX</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">docstring</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">divide</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">docstring</span>

    <span class="n">description</span><span class="p">,</span> <span class="n">param_docstring</span> <span class="o">=</span> <span class="n">divide</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">NUMPY_DOCSTRING_ARG_REGEX</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">param_docstring</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">is_display_name</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">displayed_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_display_name</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">is_display_name</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="n">param</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">_fold_text</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_fold_text</span><span class="p">(</span><span class="n">description</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">wrap_callback</span><span class="p">(</span><span class="n">coro</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">Coro</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]]]:</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CommandError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CommandInvokeError</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapped</span>


<span class="k">def</span> <span class="nf">hooked_wrapped_callback</span><span class="p">(</span>
    <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="n">coro</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">Coro</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]]]:</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CommandError</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">command_failed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">command_failed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">command_failed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">raise</span> <span class="n">CommandInvokeError</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">command</span><span class="o">.</span><span class="n">_max_concurrency</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

            <span class="k">await</span> <span class="n">command</span><span class="o">.</span><span class="n">call_after_hooks</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapped</span>


<span class="k">class</span> <span class="nc">_CaseInsensitiveDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">(),</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">(),</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">casefold</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_AttachmentIterator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">_BaseCommand</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A class that implements the protocol for a bot text command.</span>

<span class="sd">    These are not created manually, instead they are created via the</span>
<span class="sd">    decorator or functional interface.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    name: :class:`str`</span>
<span class="sd">        The name of the command.</span>
<span class="sd">    callback: :ref:`coroutine &lt;coroutine&gt;`</span>
<span class="sd">        The coroutine that is executed when the command is called.</span>
<span class="sd">    help: Optional[:class:`str`]</span>
<span class="sd">        The long help text for the command.</span>
<span class="sd">    brief: Optional[:class:`str`]</span>
<span class="sd">        The short help text for the command.</span>
<span class="sd">    usage: Optional[:class:`str`]</span>
<span class="sd">        A replacement for arguments in the default help text.</span>
<span class="sd">    aliases: Union[List[:class:`str`], Tuple[:class:`str`]]</span>
<span class="sd">        The list of aliases the command can be invoked under.</span>
<span class="sd">    enabled: :class:`bool`</span>
<span class="sd">        A boolean that indicates if the command is currently enabled.</span>
<span class="sd">        If the command is invoked while it is disabled, then</span>
<span class="sd">        :exc:`.DisabledCommand` is raised to the :func:`.on_command_error`</span>
<span class="sd">        event. Defaults to ``True``.</span>
<span class="sd">    parent: Optional[:class:`Group`]</span>
<span class="sd">        The parent group that this command belongs to. ``None`` if there</span>
<span class="sd">        isn&#39;t one.</span>
<span class="sd">    cog: Optional[:class:`Cog`]</span>
<span class="sd">        The cog that this command belongs to. ``None`` if there isn&#39;t one.</span>
<span class="sd">    checks: List[Callable[[:class:`.Context`], :class:`bool`]]</span>
<span class="sd">        A list of predicates that verifies if the command could be executed</span>
<span class="sd">        with the given :class:`.Context` as the sole parameter. If an exception</span>
<span class="sd">        is necessary to be thrown to signal failure, then one inherited from</span>
<span class="sd">        :exc:`.CommandError` should be used. Note that if the checks fail then</span>
<span class="sd">        :exc:`.CheckFailure` exception is raised to the :func:`.on_command_error`</span>
<span class="sd">        event.</span>
<span class="sd">    description: :class:`str`</span>
<span class="sd">        The message prefixed into the default help command.</span>
<span class="sd">    hidden: :class:`bool`</span>
<span class="sd">        If ``True``\, the default help command does not show this in the</span>
<span class="sd">        help output.</span>
<span class="sd">    rest_is_raw: :class:`bool`</span>
<span class="sd">        If ``False`` and a keyword-only argument is provided then the keyword</span>
<span class="sd">        only argument is stripped and handled as if it was a regular argument</span>
<span class="sd">        that handles :exc:`.MissingRequiredArgument` and default values in a</span>
<span class="sd">        regular matter rather than passing the rest completely raw. If ``True``</span>
<span class="sd">        then the keyword-only argument will pass in the rest of the arguments</span>
<span class="sd">        in a completely raw matter. Defaults to ``False``.</span>
<span class="sd">    invoked_subcommand: Optional[:class:`Command`]</span>
<span class="sd">        The subcommand that was invoked, if any.</span>
<span class="sd">    require_var_positional: :class:`bool`</span>
<span class="sd">        If ``True`` and a variadic positional argument is specified, requires</span>
<span class="sd">        the user to specify at least one argument. Defaults to ``False``.</span>

<span class="sd">        .. versionadded:: 1.5</span>

<span class="sd">    ignore_extra: :class:`bool`</span>
<span class="sd">        If ``True``\, ignores extraneous strings passed to a command if all its</span>
<span class="sd">        requirements are met (e.g. ``?foo a b c`` when only expecting ``a``</span>
<span class="sd">        and ``b``). Otherwise :func:`.on_command_error` and local error handlers</span>
<span class="sd">        are called with :exc:`.TooManyArguments`. Defaults to ``True``.</span>
<span class="sd">    cooldown_after_parsing: :class:`bool`</span>
<span class="sd">        If ``True``\, cooldown processing is done after argument parsing,</span>
<span class="sd">        which calls converters. If ``False`` then cooldown processing is done</span>
<span class="sd">        first and then the converters are called second. Defaults to ``False``.</span>
<span class="sd">    extras: :class:`dict`</span>
<span class="sd">        A dict of user provided extras to attach to the Command.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This object may be copied by the library.</span>


<span class="sd">        .. versionadded:: 2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__original_kwargs__</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="c1"># if you&#39;re wondering why this is done, it&#39;s because we need to ensure</span>
        <span class="c1"># we have a complete original copy of **kwargs even for classes that</span>
        <span class="c1"># mess with it by popping before delegating to the subclass __init__.</span>
        <span class="c1"># In order to do this, we need to control the instance creation and</span>
        <span class="c1"># inject the original kwargs through __new__ rather than doing it</span>
        <span class="c1"># inside __init__.</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># we do a shallow copy because it&#39;s probably the most common use case.</span>
        <span class="c1"># this could potentially break if someone modifies a list or something</span>
        <span class="c1"># while it&#39;s in movement, but for now this is the cheapest and</span>
        <span class="c1"># fastest way to do what we want.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__original_kwargs__</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
        <span class="p">],</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Callback must be a coroutine.&#39;</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Name of a command must be a string.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">help_doc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;help&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">help_doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">help_doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">help_doc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">help_doc</span> <span class="o">=</span> <span class="n">extract_descriptions_from_docstring</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">help_doc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">brief</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;brief&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rest_is_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rest_is_raw&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aliases&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extras</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extras&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Aliases of a command must be a list or a tuple of strings.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hidden&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">checks</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span>
            <span class="n">checks</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">checks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;checks&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">checks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">UserCheck</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">checks</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cooldown</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__commands_cooldown__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">cooldown</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cooldown&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cooldown</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">buckets</span> <span class="o">=</span> <span class="n">CooldownMapping</span><span class="p">(</span><span class="n">cooldown</span><span class="p">,</span> <span class="n">BucketType</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cooldown</span><span class="p">,</span> <span class="n">CooldownMapping</span><span class="p">):</span>
            <span class="n">buckets</span><span class="p">:</span> <span class="n">CooldownMapping</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cooldown</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cooldown must be an instance of CooldownMapping or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="p">:</span> <span class="n">CooldownMapping</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">buckets</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__commands_max_concurrency__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">max_concurrency</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_concurrency&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MaxConcurrency</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_concurrency</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">require_var_positional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;require_var_positional&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_extra</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore_extra&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooldown_after_parsing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cooldown_after_parsing&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cog</span><span class="p">:</span> <span class="n">CogT</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore # This breaks every other pyright release</span>

        <span class="c1"># bandaid for the fact that sometimes parent can be the bot instance</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GroupMixin</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GroupMixin</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parent</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">_BaseCommand</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Hook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">before_invoke</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__before_invoke__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">before_invoke</span><span class="p">(</span><span class="n">before_invoke</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Hook</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">after_invoke</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">__after_invoke__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">after_invoke</span><span class="p">(</span><span class="n">after_invoke</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CogT</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cog</span>

    <span class="nd">@cog</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">CogT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cog</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span>

    <span class="nd">@callback</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">function</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callback</span> <span class="o">=</span> <span class="n">function</span>
        <span class="n">unwrap</span> <span class="o">=</span> <span class="n">unwrap_function</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">unwrap</span><span class="o">.</span><span class="vm">__module__</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">globalns</span> <span class="o">=</span> <span class="n">unwrap</span><span class="o">.</span><span class="vm">__globals__</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">globalns</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_signature_parameters</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">globalns</span><span class="p">)</span>

<div class="viewcode-block" id="Command.add_check">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.add_check">[docs]</a>
    <span class="k">def</span> <span class="nf">add_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">UserCheck</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a check to the command.</span>

<span class="sd">        This is the non-decorator interface to :func:`.check`.</span>

<span class="sd">        .. versionadded:: 1.3</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``func`` parameter is now positional-only.</span>

<span class="sd">        .. seealso:: The :func:`~discord.ext.commands.check` decorator</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        func</span>
<span class="sd">            The function that will be used as a check.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>


<div class="viewcode-block" id="Command.remove_check">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.remove_check">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">UserCheck</span><span class="p">[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes a check from the command.</span>

<span class="sd">        This function is idempotent and will not raise an exception</span>
<span class="sd">        if the function is not in the command&#39;s checks.</span>

<span class="sd">        .. versionadded:: 1.3</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``func`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        func</span>
<span class="sd">            The function to remove from the checks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="Command.update">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.update">[docs]</a>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates :class:`Command` instance with updated attribute.</span>

<span class="sd">        This works similarly to the :func:`~discord.ext.commands.command` decorator in terms</span>
<span class="sd">        of parameters in that they are passed to the :class:`Command` or</span>
<span class="sd">        subclass constructors, sans the name and callback.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__original_kwargs__</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cog</span> <span class="o">=</span> <span class="n">cog</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;|coro|</span>

<span class="sd">        Calls the internal callback that the command holds.</span>

<span class="sd">        .. note::</span>

<span class="sd">            This bypasses all mechanisms -- including checks, converters,</span>
<span class="sd">            invoke hooks, cooldowns, etc. You must take care to pass</span>
<span class="sd">            the proper arguments and types to this function.</span>

<span class="sd">        .. versionadded:: 1.3</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``context`` parameter is now positional-only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cog</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">_ensure_assignment_on_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_before_invoke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span>
        <span class="n">other</span><span class="o">.</span><span class="n">_after_invoke</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span>
        <span class="n">other</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extras</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checks</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">checks</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">checks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">valid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_buckets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_max_concurrency</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">other</span><span class="o">.</span><span class="n">on_error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">other</span>

<div class="viewcode-block" id="Command.copy">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a copy of this command.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`Command`</span>
<span class="sd">            A new instance of this command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__original_kwargs__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_assignment_on_copy</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_update_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__original_kwargs__</span><span class="p">)</span>
            <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_assignment_on_copy</span><span class="p">(</span><span class="n">copy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">dispatch_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="n">error</span><span class="p">:</span> <span class="n">CommandError</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">command_failed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">cog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">coro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">injected</span> <span class="o">=</span> <span class="n">wrap_callback</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">injected</span><span class="p">(</span><span class="n">cog</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">injected</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">local</span> <span class="o">=</span> <span class="n">Cog</span><span class="o">.</span><span class="n">_get_overridden_method</span><span class="p">(</span><span class="n">cog</span><span class="o">.</span><span class="n">cog_command_error</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">local</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrapped</span> <span class="o">=</span> <span class="n">wrap_callback</span><span class="p">(</span><span class="n">local</span><span class="p">)</span>
                    <span class="k">await</span> <span class="n">wrapped</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s1">&#39;command_error&#39;</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="n">param</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">attachments</span><span class="p">:</span> <span class="n">_AttachmentIterator</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">converter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">converter</span>
        <span class="n">consume_rest_is_special</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_is_raw</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view</span>
        <span class="n">view</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">()</span>

        <span class="c1"># The greedy converter is simple -- it keeps going until it fails in which case,</span>
        <span class="c1"># it undos the view ready for the next parameter to use instead</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">converter</span><span class="p">,</span> <span class="n">Greedy</span><span class="p">):</span>
            <span class="c1"># Special case for Greedy[discord.Attachment] to consume the attachments iterator</span>
            <span class="k">if</span> <span class="n">converter</span><span class="o">.</span><span class="n">converter</span> <span class="ow">is</span> <span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">attachments</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">):</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_greedy_pos</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">required</span><span class="p">,</span> <span class="n">converter</span><span class="o">.</span><span class="n">constructed_converter</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_greedy_var_pos</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">converter</span><span class="o">.</span><span class="n">constructed_converter</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if we&#39;re here, then it&#39;s a KEYWORD_ONLY param type</span>
                <span class="c1"># since this is mostly useless, we&#39;ll helpfully transform Greedy[X]</span>
                <span class="c1"># into just X and do the parsing that way.</span>
                <span class="n">converter</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">constructed_converter</span>

        <span class="c1"># Try to detect Optional[discord.Attachment] or discord.Attachment special converter</span>
        <span class="k">if</span> <span class="n">converter</span> <span class="ow">is</span> <span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">attachments</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MissingRequiredAttachment</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_typing_optional</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attachments</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
                <span class="c1"># I have no idea who would be doing Optional[discord.Attachment] = 1</span>
                <span class="c1"># but for those cases then 1 should be returned instead of None</span>
                <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">attachments</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">()</span>  <span class="c1"># break the loop</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_typing_optional</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">converter</span><span class="p">,</span> <span class="s1">&#39;__commands_is_flag__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">converter</span><span class="o">.</span><span class="n">_can_be_constructible</span><span class="p">():</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="n">converter</span><span class="o">.</span><span class="n">_construct_default</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">MissingRequiredArgument</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">param</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">previous</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">index</span>
        <span class="k">if</span> <span class="n">consume_rest_is_special</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">current_argument</span> <span class="o">=</span> <span class="n">argument</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">read_rest</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">current_argument</span> <span class="o">=</span> <span class="n">argument</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_quoted_word</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">ArgumentParsingError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_typing_optional</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">):</span>
                    <span class="n">view</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">previous</span>
                    <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">required</span> <span class="k">else</span> <span class="k">await</span> <span class="n">param</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">exc</span>
        <span class="n">view</span><span class="o">.</span><span class="n">previous</span> <span class="o">=</span> <span class="n">previous</span>

        <span class="c1"># type-checker fails to narrow argument</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">run_converters</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_transform_greedy_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="n">param</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">required</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">converter</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">view</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>
            <span class="c1"># for use with a manual undo</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">index</span>

            <span class="n">view</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">current_argument</span> <span class="o">=</span> <span class="n">argument</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_quoted_word</span><span class="p">()</span>
                <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_converters</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">CommandError</span><span class="p">,</span> <span class="n">ArgumentParsingError</span><span class="p">):</span>
                <span class="n">view</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">previous</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">required</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">param</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_transform_greedy_var_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="n">param</span><span class="p">:</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">converter</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">index</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">current_argument</span> <span class="o">=</span> <span class="n">argument</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_quoted_word</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_converters</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">CommandError</span><span class="p">,</span> <span class="n">ArgumentParsingError</span><span class="p">):</span>
            <span class="n">view</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">previous</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">()</span> <span class="kn">from</span> <span class="kc">None</span>  <span class="c1"># break loop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">clean_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dict[:class:`str`, :class:`Parameter`]:</span>
<span class="sd">        Retrieves the parameter dictionary without the context or self parameters.</span>

<span class="sd">        Useful for inspecting signature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cooldown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Cooldown</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional[:class:`~discord.app_commands.Cooldown`]: The cooldown of a command when invoked</span>
<span class="sd">        or ``None`` if the command doesn&#39;t have a registered cooldown.</span>

<span class="sd">        .. versionadded:: 2.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">_cooldown</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_parent_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`str`: Retrieves the fully qualified parent command name.</span>

<span class="sd">        This the base command name required to execute it. For example,</span>
<span class="sd">        in ``?one two three`` the parent name would be ``one two``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># command.parent is type-hinted as GroupMixin some attributes are resolved via MRO</span>
        <span class="k">while</span> <span class="n">command</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">parent</span>  <span class="c1"># type: ignore</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">entries</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Group</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List[:class:`Group`]: Retrieves the parents of this command.</span>

<span class="sd">        If the command has no parents then it returns an empty :class:`list`.</span>

<span class="sd">        For example in commands ``?a b c test``, the parents are ``[c, b, a]``.</span>

<span class="sd">        .. versionadded:: 1.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">command</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">parent</span>  <span class="c1"># type: ignore</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entries</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Group</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional[:class:`Group`]: Retrieves the root parent of this command.</span>

<span class="sd">        If the command has no parents then it returns ``None``.</span>

<span class="sd">        For example in commands ``?a b c test``, the root parent is ``a``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qualified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`str`: Retrieves the fully qualified command name.</span>

<span class="sd">        This is the full parent name with the command name as well.</span>
<span class="sd">        For example, in ``?one two three`` the qualified name would be</span>
<span class="sd">        ``one two three``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_parent_name</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualified_name</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_parse_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctx</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cog</span><span class="p">,</span> <span class="n">ctx</span><span class="p">]</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">args</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span>
        <span class="n">attachments</span> <span class="o">=</span> <span class="n">_AttachmentIterator</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">attachments</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">current_parameter</span> <span class="o">=</span> <span class="n">param</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">):</span>
                <span class="n">transformed</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformed</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span><span class="p">:</span>
                <span class="c1"># kwarg only param denotes &quot;consume rest&quot; semantics</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rest_is_raw</span><span class="p">:</span>
                    <span class="n">ctx</span><span class="o">.</span><span class="n">current_argument</span> <span class="o">=</span> <span class="n">argument</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">read_rest</span><span class="p">()</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_converters</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">converter</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">eof</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_var_positional</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MissingRequiredArgument</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">view</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">transformed</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">attachments</span><span class="p">)</span>
                        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformed</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_extra</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">view</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TooManyArguments</span><span class="p">(</span><span class="s1">&#39;Too many arguments passed to &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualified_name</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">call_before_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># now that we&#39;re done preparing we can call the pre-command hooks</span>
        <span class="c1"># first, call the command local hook:</span>
        <span class="n">cog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># should be cog if @commands.before_invoke is used</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span> <span class="n">cog</span><span class="p">)</span>
            <span class="c1"># __self__ only exists for methods, not functions</span>
            <span class="c1"># however, if @command.before_invoke is used, it will be a function</span>
            <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># call the cog local hook if applicable:</span>
        <span class="k">if</span> <span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hook</span> <span class="o">=</span> <span class="n">Cog</span><span class="o">.</span><span class="n">_get_overridden_method</span><span class="p">(</span><span class="n">cog</span><span class="o">.</span><span class="n">cog_before_invoke</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="c1"># call the bot global hook if necessary</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">_before_invoke</span>
        <span class="k">if</span> <span class="n">hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">call_after_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">,</span> <span class="n">cog</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instance</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># call the cog local hook if applicable:</span>
        <span class="k">if</span> <span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hook</span> <span class="o">=</span> <span class="n">Cog</span><span class="o">.</span><span class="n">_get_overridden_method</span><span class="p">(</span><span class="n">cog</span><span class="o">.</span><span class="n">cog_after_invoke</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">hook</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">_after_invoke</span>
        <span class="k">if</span> <span class="n">hook</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">hook</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_cooldowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">edited_at</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">created_at</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">retry_after</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">update_rate_limit</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">retry_after</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CommandOnCooldown</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">retry_after</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_run</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CheckFailure</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The check functions for command </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qualified_name</span><span class="si">}</span><span class="s1"> failed.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># For this application, context can be duck-typed as a Message</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooldown_after_parsing</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_arguments</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_cooldowns</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_cooldowns</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_arguments</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_before_hooks</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_concurrency</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">raise</span>

<div class="viewcode-block" id="Command.is_on_cooldown">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.is_on_cooldown">[docs]</a>
    <span class="k">def</span> <span class="nf">is_on_cooldown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks whether the command is currently on cooldown.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``ctx`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        ctx: :class:`.Context`</span>
<span class="sd">            The invocation context to use when checking the commands cooldown status.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`bool`</span>
<span class="sd">            A boolean indicating if the command is on cooldown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bucket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">edited_at</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">created_at</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_tokens</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Command.reset_cooldown">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.reset_cooldown">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_cooldown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resets the cooldown on this command.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``ctx`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        ctx: :class:`.Context`</span>
<span class="sd">            The invocation context to reset the cooldown under.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bucket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bucket</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>


<div class="viewcode-block" id="Command.get_cooldown_retry_after">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.get_cooldown_retry_after">[docs]</a>
    <span class="k">def</span> <span class="nf">get_cooldown_retry_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the amount of seconds before this command can be tried again.</span>

<span class="sd">        .. versionadded:: 1.4</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``ctx`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        ctx: :class:`.Context`</span>
<span class="sd">            The invocation context to retrieve the cooldown from.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`float`</span>
<span class="sd">            The amount of time left on this command&#39;s cooldown in seconds.</span>
<span class="sd">            If this is ``0.0`` then the command isn&#39;t on cooldown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buckets</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bucket</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">edited_at</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">created_at</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">bucket</span><span class="o">.</span><span class="n">get_retry_after</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

        <span class="k">return</span> <span class="mf">0.0</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="c1"># terminate the invoked_subcommand chain.</span>
        <span class="c1"># since we&#39;re in a regular command (and not a group) then</span>
        <span class="c1"># the invoked subcommand is None.</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">subcommand_passed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">injected</span> <span class="o">=</span> <span class="n">hooked_wrapped_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">await</span> <span class="n">injected</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">reinvoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">call_hooks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_arguments</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">call_hooks</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_before_hooks</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">command_failed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">call_hooks</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_after_hooks</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">:</span> <span class="n">Error</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Error</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A decorator that registers a coroutine as a local error handler.</span>

<span class="sd">        A local error handler is an :func:`.on_command_error` event limited to</span>
<span class="sd">        a single command. However, the :func:`.on_command_error` is still</span>
<span class="sd">        invoked afterwards as the catch-all.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``coro`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        coro: :ref:`coroutine &lt;coroutine&gt;`</span>
<span class="sd">            The coroutine to register as the local error handler.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            The coroutine passed is not actually a coroutine.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">coro</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The error handler must be a coroutine.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_error</span><span class="p">:</span> <span class="n">Error</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">coro</span>
        <span class="k">return</span> <span class="n">coro</span>

<div class="viewcode-block" id="Command.has_error_handler">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.has_error_handler">[docs]</a>
    <span class="k">def</span> <span class="nf">has_error_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`bool`: Checks whether the command has an error handler registered.</span>

<span class="sd">        .. versionadded:: 1.7</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;on_error&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Command.before_invoke">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.before_invoke">[docs]</a>
    <span class="k">def</span> <span class="nf">before_invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">:</span> <span class="n">Hook</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hook</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A decorator that registers a coroutine as a pre-invoke hook.</span>

<span class="sd">        A pre-invoke hook is called directly before the command is</span>
<span class="sd">        called. This makes it a useful function to set up database</span>
<span class="sd">        connections or any type of set up required.</span>

<span class="sd">        This pre-invoke hook takes a sole parameter, a :class:`.Context`.</span>

<span class="sd">        See :meth:`.Bot.before_invoke` for more info.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``coro`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        coro: :ref:`coroutine &lt;coroutine&gt;`</span>
<span class="sd">            The coroutine to register as the pre-invoke hook.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            The coroutine passed is not actually a coroutine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">coro</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The pre-invoke hook must be a coroutine.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_before_invoke</span> <span class="o">=</span> <span class="n">coro</span>
        <span class="k">return</span> <span class="n">coro</span></div>


<div class="viewcode-block" id="Command.after_invoke">
<a class="viewcode-back" href="../../../../framework_commands.html#starbot.core.commands.Command.after_invoke">[docs]</a>
    <span class="k">def</span> <span class="nf">after_invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coro</span><span class="p">:</span> <span class="n">Hook</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hook</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A decorator that registers a coroutine as a post-invoke hook.</span>

<span class="sd">        A post-invoke hook is called directly after the command is</span>
<span class="sd">        called. This makes it a useful function to clean-up database</span>
<span class="sd">        connections or any type of clean up required.</span>

<span class="sd">        This post-invoke hook takes a sole parameter, a :class:`.Context`.</span>

<span class="sd">        See :meth:`.Bot.after_invoke` for more info.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``coro`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        coro: :ref:`coroutine &lt;coroutine&gt;`</span>
<span class="sd">            The coroutine to register as the post-invoke hook.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            The coroutine passed is not actually a coroutine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">coro</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The post-invoke hook must be a coroutine.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_after_invoke</span> <span class="o">=</span> <span class="n">coro</span>
        <span class="k">return</span> <span class="n">coro</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cog_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional[:class:`str`]: The name of the cog this command belongs to, if any.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cog</span><span class="p">)</span><span class="o">.</span><span class="n">__cog_name__</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`str`: Gets the &quot;short&quot; documentation of a command.</span>

<span class="sd">        By default, this is the :attr:`.brief` attribute.</span>
<span class="sd">        If that lookup leads to an empty string then the first line of the</span>
<span class="sd">        :attr:`.help` attribute is used instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">brief</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">brief</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_is_typing_optional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">T</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s1">&#39;__origin__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Union</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">annotation</span><span class="o">.</span><span class="n">__args__</span>  <span class="c1"># type: ignore</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`str`: Returns a POSIX-like signature useful for help command output.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">displayed_name</span> <span class="ow">or</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span>

            <span class="n">greedy</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">converter</span><span class="p">,</span> <span class="n">Greedy</span><span class="p">)</span>
            <span class="n">optional</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># postpone evaluation of if it&#39;s an optional argument</span>

            <span class="n">annotation</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">converter</span><span class="o">.</span><span class="n">converter</span> <span class="k">if</span> <span class="n">greedy</span> <span class="k">else</span> <span class="n">param</span><span class="o">.</span><span class="n">converter</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s1">&#39;__origin__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">greedy</span> <span class="ow">and</span> <span class="n">origin</span> <span class="ow">is</span> <span class="n">Union</span><span class="p">:</span>
                <span class="n">none_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">union_args</span> <span class="o">=</span> <span class="n">annotation</span><span class="o">.</span><span class="n">__args__</span>
                <span class="n">optional</span> <span class="o">=</span> <span class="n">union_args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="n">none_cls</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">union_args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">optional</span><span class="p">:</span>
                    <span class="n">annotation</span> <span class="o">=</span> <span class="n">union_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">origin</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="s1">&#39;__origin__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="n">discord</span><span class="o">.</span><span class="n">Attachment</span><span class="p">:</span>
                <span class="c1"># For discord.Attachment we need to signal to the user that it&#39;s an attachment</span>
                <span class="c1"># It&#39;s not exactly pretty but it&#39;s enough to differentiate</span>
                <span class="k">if</span> <span class="n">optional</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (upload a file)]&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">greedy</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (upload files)]...&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (upload a file)&gt;&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># for typing.Literal[...], typing.Optional[typing.Literal[...]], and Greedy[typing.Literal[...]], the</span>
            <span class="c1"># parameter signature is a literal list of it&#39;s values</span>
            <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="n">Literal</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">annotation</span><span class="o">.</span><span class="n">__args__</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="c1"># We don&#39;t want None or &#39;&#39; to trigger the [name=value] case and instead it should</span>
                <span class="c1"># do [name] since [name=None] or [name=] are not exactly useful for the user.</span>
                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">displayed_default</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">displayed_default</span><span class="si">}</span><span class="s1">]&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">greedy</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">displayed_default</span><span class="si">}</span><span class="s1">]...&#39;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_var_positional</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">...&gt;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">...]&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">greedy</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">]...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">optional</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">can_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;|coro|</span>

<span class="sd">        Checks if the command can be executed by checking all the predicates</span>
<span class="sd">        inside the :attr:`~Command.checks` attribute. This also checks whether the</span>
<span class="sd">        command is disabled.</span>

<span class="sd">        .. versionchanged:: 1.3</span>
<span class="sd">            Checks whether the command is disabled or not</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``ctx`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        ctx: :class:`.Context`</span>
<span class="sd">            The ctx of the command currently being invoked.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`CommandError`</span>
<span class="sd">            Any command error that was raised during a check call will be propagated</span>
<span class="sd">            by this function.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`bool`</span>
<span class="sd">            A boolean indicating if the command can be invoked.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DisabledCommand</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> command is disabled&#39;</span><span class="p">)</span>

        <span class="n">original</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">command</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">can_run</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">CheckFailure</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The global check functions for command </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">qualified_name</span><span class="si">}</span><span class="s1"> failed.&#39;</span><span class="p">)</span>

            <span class="n">cog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cog</span>
            <span class="k">if</span> <span class="n">cog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">local_check</span> <span class="o">=</span> <span class="n">Cog</span><span class="o">.</span><span class="n">_get_overridden_method</span><span class="p">(</span><span class="n">cog</span><span class="o">.</span><span class="n">cog_check</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">local_check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="k">await</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">maybe_coroutine</span><span class="p">(</span><span class="n">local_check</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">False</span>

            <span class="n">predicates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checks</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">predicates</span><span class="p">:</span>
                <span class="c1"># since we have no checks, then we just return True.</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="k">await</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">async_all</span><span class="p">(</span><span class="n">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="k">for</span> <span class="n">predicate</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">original</span>


<span class="k">class</span> <span class="nc">GroupMixin</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">CogT</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A mixin that implements common functionality for classes that behave</span>
<span class="sd">    similar to :class:`.Group` and are allowed to register commands.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    all_commands: :class:`dict`</span>
<span class="sd">        A mapping of command name to :class:`.Command`</span>
<span class="sd">        objects.</span>
<span class="sd">    case_insensitive: :class:`bool`</span>
<span class="sd">        Whether the commands should be case insensitive. Defaults to ``False``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">case_insensitive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;case_insensitive&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_CaseInsensitiveDict</span><span class="p">()</span> <span class="k">if</span> <span class="n">case_insensitive</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_insensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">case_insensitive</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">commands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set[:class:`.Command`]: A unique set of commands without aliases that are registered.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">recursively_remove_all_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">GroupMixin</span><span class="p">):</span>
                <span class="n">command</span><span class="o">.</span><span class="n">recursively_remove_all_commands</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_command</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a :class:`.Command` into the internal list of commands.</span>

<span class="sd">        This is usually not called, instead the :meth:`~.GroupMixin.command` or</span>
<span class="sd">        :meth:`~.GroupMixin.group` shortcut decorators are used instead.</span>

<span class="sd">        .. versionchanged:: 1.4</span>
<span class="sd">             Raise :exc:`.CommandRegistrationError` instead of generic :exc:`.ClientException`</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``command`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        command: :class:`Command`</span>
<span class="sd">            The command to add.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        CommandRegistrationError</span>
<span class="sd">            If the command or its alias is already registered by different command.</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the command passed is not a subclass of :class:`.Command`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The command passed must be a subclass of Command&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">command</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CommandRegistrationError</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="p">[</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alias</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_command</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">CommandRegistrationError</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">alias_conflict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>

    <span class="k">def</span> <span class="nf">remove_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a :class:`.Command` from the internal list</span>
<span class="sd">        of commands.</span>

<span class="sd">        This could also be used as a way to remove aliases.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``name`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        name: :class:`str`</span>
<span class="sd">            The name of the command to remove.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Optional[:class:`.Command`]</span>
<span class="sd">            The command that was removed. If the name is not valid then</span>
<span class="sd">            ``None`` is returned instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># does not exist</span>
        <span class="k">if</span> <span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="c1"># we&#39;re removing an alias so we don&#39;t want to remove the rest</span>
            <span class="k">return</span> <span class="n">command</span>

        <span class="c1"># we&#39;re not removing the alias so let&#39;s delete the rest of them.</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># in the case of a CommandRegistrationError, an alias might conflict</span>
            <span class="c1"># with an already existing command. If this is the case, we want to</span>
            <span class="c1"># make sure the pre-existing command is not removed.</span>
            <span class="k">if</span> <span class="n">cmd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cmd</span> <span class="o">!=</span> <span class="n">command</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span>
        <span class="k">return</span> <span class="n">command</span>

    <span class="k">def</span> <span class="nf">walk_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An iterator that recursively walks through all commands and subcommands.</span>

<span class="sd">        .. versionchanged:: 1.4</span>
<span class="sd">            Duplicates due to aliases are no longer returned</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        Union[:class:`.Command`, :class:`.Group`]</span>
<span class="sd">            A command or group from the internal list of commands.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">command</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">GroupMixin</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">command</span><span class="o">.</span><span class="n">walk_commands</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a :class:`.Command` from the internal list</span>
<span class="sd">        of commands.</span>

<span class="sd">        This could also be used as a way to get aliases.</span>

<span class="sd">        The name could be fully qualified (e.g. ``&#39;foo bar&#39;``) will get</span>
<span class="sd">        the subcommand ``bar`` of the group command ``foo``. If a</span>
<span class="sd">        subcommand is not found then ``None`` is returned just as usual.</span>

<span class="sd">        .. versionchanged:: 2.0</span>

<span class="sd">            ``name`` parameter is now positional-only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        name: :class:`str`</span>
<span class="sd">            The name of the command to get.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Optional[:class:`Command`]</span>
<span class="sd">            The command that was requested. If not found, returns ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># fast path, no space in name.</span>
        <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">names</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GroupMixin</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">all_commands</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">GroupMixin</span><span class="p">[</span><span class="n">CogT</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">GroupMixin</span><span class="p">[</span><span class="n">CogT</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">CommandT</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>  <span class="c1"># type: ignore  # previous overload handles case where cls is not set</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">CommandT</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A shortcut decorator that invokes :func:`~discord.ext.commands.command` and adds it to</span>
<span class="sd">        the internal command list via :meth:`~.GroupMixin.add_command`.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Callable[..., :class:`Command`]</span>
<span class="sd">            A decorator that converts the provided method into a Command, adds it to the bot, then returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>

            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">GroupMixin</span><span class="p">[</span><span class="n">CogT</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">Group</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span>
    <span class="p">]:</span>
        <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">GroupMixin</span><span class="p">[</span><span class="n">CogT</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">GroupT</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>  <span class="c1"># type: ignore  # previous overload handles case where cls is not set</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span>
            <span class="n">Union</span><span class="p">[</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
                <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">GroupT</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Group</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A shortcut decorator that invokes :func:`.group` and adds it to</span>
<span class="sd">        the internal command list via :meth:`~.GroupMixin.add_command`.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        Callable[..., :class:`Group`]</span>
<span class="sd">            A decorator that converts the provided method into a Group, adds it to the bot, then returns it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">decorator</span>


<span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">GroupMixin</span><span class="p">[</span><span class="n">CogT</span><span class="p">],</span> <span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class that implements a grouping protocol for commands to be</span>
<span class="sd">    executed as subcommands.</span>

<span class="sd">    This class is a subclass of :class:`.Command` and thus all options</span>
<span class="sd">    valid in :class:`.Command` are valid in here as well.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    invoke_without_command: :class:`bool`</span>
<span class="sd">        Indicates if the group callback should begin parsing and</span>
<span class="sd">        invocation only if no subcommand was found. Useful for</span>
<span class="sd">        making it an error handling function to tell the user that</span>
<span class="sd">        no subcommand was found or to have different functionality</span>
<span class="sd">        in case no subcommand was found. If this is ``False``, then</span>
<span class="sd">        the group callback will always be invoked first. This means</span>
<span class="sd">        that the checks and the parsing dictated by its parameters</span>
<span class="sd">        will be executed. Defaults to ``False``.</span>
<span class="sd">    case_insensitive: :class:`bool`</span>
<span class="sd">        Indicates if the group&#39;s commands should be case insensitive.</span>
<span class="sd">        Defaults to ``False``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invoke_without_command</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;invoke_without_command&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a copy of this :class:`Group`.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        :class:`Group`</span>
<span class="sd">            A new instance of this group.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">subcommand_passed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">early_invoke</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_without_command</span>
        <span class="k">if</span> <span class="n">early_invoke</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">index</span>
        <span class="n">view</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">()</span>
        <span class="n">trigger</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_word</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">trigger</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">subcommand_passed</span> <span class="o">=</span> <span class="n">trigger</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">early_invoke</span><span class="p">:</span>
            <span class="n">injected</span> <span class="o">=</span> <span class="n">hooked_wrapped_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">await</span> <span class="n">injected</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">invoked_with</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="n">trigger</span> <span class="ow">and</span> <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_with</span> <span class="o">=</span> <span class="n">trigger</span>
            <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">early_invoke</span><span class="p">:</span>
            <span class="c1"># undo the trigger parsing</span>
            <span class="n">view</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">previous</span>
            <span class="n">view</span><span class="o">.</span><span class="n">previous</span> <span class="o">=</span> <span class="n">previous</span>
            <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">reinvoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">call_hooks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">early_invoke</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_without_command</span>
        <span class="k">if</span> <span class="n">early_invoke</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_arguments</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">call_hooks</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_before_hooks</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">view</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">index</span>
        <span class="n">view</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">()</span>
        <span class="n">trigger</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">get_word</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">trigger</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">subcommand_passed</span> <span class="o">=</span> <span class="n">trigger</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_commands</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">early_invoke</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">ctx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">command_failed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call_hooks</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_after_hooks</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">invoked_with</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="n">trigger</span> <span class="ow">and</span> <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span><span class="p">:</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_with</span> <span class="o">=</span> <span class="n">trigger</span>
            <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">invoked_subcommand</span><span class="o">.</span><span class="n">reinvoke</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">call_hooks</span><span class="o">=</span><span class="n">call_hooks</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">early_invoke</span><span class="p">:</span>
            <span class="c1"># undo the trigger parsing</span>
            <span class="n">view</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">previous</span>
            <span class="n">view</span><span class="o">.</span><span class="n">previous</span> <span class="o">=</span> <span class="n">previous</span>
            <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reinvoke</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">call_hooks</span><span class="o">=</span><span class="n">call_hooks</span><span class="p">)</span>


<span class="c1"># Decorators</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="c1"># Using a class to emulate a function allows for overloading the inner function in the decorator.</span>

    <span class="k">class</span> <span class="nc">_CommandDecorator</span><span class="p">:</span>
        <span class="nd">@overload</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
            <span class="o">...</span>

        <span class="nd">@overload</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Command</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
            <span class="o">...</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
            <span class="o">...</span>

    <span class="k">class</span> <span class="nc">_GroupDecorator</span><span class="p">:</span>
        <span class="nd">@overload</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Group</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
            <span class="o">...</span>

        <span class="nd">@overload</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Group</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
            <span class="o">...</span>

        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Coro</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
            <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_CommandDecorator</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">CommandT</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>  <span class="c1"># type: ignore  # previous overload handles case where cls is not set</span>
    <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
    <span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>  <span class="c1"># type: ignore # CogT is used here to allow covariance</span>
        <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">CommandT</span><span class="p">,</span>
<span class="p">]:</span>
    <span class="o">...</span>


<span class="k">def</span> <span class="nf">command</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
    <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that transforms a function into a :class:`.Command`</span>
<span class="sd">    or if called with :func:`.group`, :class:`.Group`.</span>

<span class="sd">    By default the ``help`` attribute is received automatically from the</span>
<span class="sd">    docstring of the function and is cleaned up with the use of</span>
<span class="sd">    ``inspect.cleandoc``. If the docstring is ``bytes``, then it is decoded</span>
<span class="sd">    into :class:`str` using utf-8 encoding.</span>

<span class="sd">    All checks added using the :func:`.check` &amp; co. decorators are added into</span>
<span class="sd">    the function. There is no way to supply your own checks through this</span>
<span class="sd">    decorator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    name: :class:`str`</span>
<span class="sd">        The name to create the command with. By default this uses the</span>
<span class="sd">        function name unchanged.</span>
<span class="sd">    cls</span>
<span class="sd">        The class to construct with. By default this is :class:`.Command`.</span>
<span class="sd">        You usually do not change this.</span>
<span class="sd">    attrs</span>
<span class="sd">        Keyword arguments to pass into the construction of the class denoted</span>
<span class="sd">        by ``cls``.</span>

<span class="sd">    Raises</span>
<span class="sd">    -------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the function is not a coroutine or is already a command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">Command</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Callback is already a command.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">decorator</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">group</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_GroupDecorator</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">group</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">GroupT</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>  <span class="c1"># type: ignore  # previous overload handles case where cls is not set</span>
    <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span>
    <span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>  <span class="c1"># type: ignore # CogT is used here to allow covariance</span>
            <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="n">ContextT</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">Coro</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
        <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">GroupT</span><span class="p">,</span>
<span class="p">]:</span>
    <span class="o">...</span>


<span class="k">def</span> <span class="nf">group</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Group</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MISSING</span><span class="p">,</span>
    <span class="o">**</span><span class="n">attrs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that transforms a function into a :class:`.Group`.</span>

<span class="sd">    This is similar to the :func:`~discord.ext.commands.command` decorator but the ``cls``</span>
<span class="sd">    parameter is set to :class:`Group` by default.</span>

<span class="sd">    .. versionchanged:: 1.1</span>
<span class="sd">        The ``cls`` parameter can now be passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="n">MISSING</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">Group</span>

    <span class="k">return</span> <span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="n">UserCheck</span><span class="p">[</span><span class="n">ContextT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">ContextT</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A decorator that adds a check to the :class:`.Command` or its</span>
<span class="sd">    subclasses. These checks could be accessed via :attr:`.Command.checks`.</span>

<span class="sd">    These checks should be predicates that take in a single parameter taking</span>
<span class="sd">    a :class:`.Context`. If the check returns a ``False``\-like value then</span>
<span class="sd">    during invocation a :exc:`.CheckFailure` exception is raised and sent to</span>
<span class="sd">    the :func:`.on_command_error` event.</span>

<span class="sd">    If an exception should be thrown in the predicate then it should be a</span>
<span class="sd">    subclass of :exc:`.CommandError`. Any exception not subclassed from it</span>
<span class="sd">    will be propagated while those subclassed will be sent to</span>
<span class="sd">    :func:`.on_command_error`.</span>

<span class="sd">    A special attribute named ``predicate`` is bound to the value</span>
<span class="sd">    returned by this decorator to retrieve the predicate passed to the</span>
<span class="sd">    decorator. This allows the following introspection and chaining to be done:</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        def owner_or_permissions(**perms):</span>
<span class="sd">            original = commands.has_permissions(**perms).predicate</span>
<span class="sd">            async def extended_check(ctx):</span>
<span class="sd">                if ctx.guild is None:</span>
<span class="sd">                    return False</span>
<span class="sd">                return ctx.guild.owner_id == ctx.author.id or await original(ctx)</span>
<span class="sd">            return commands.check(extended_check)</span>

<span class="sd">    .. note::</span>

<span class="sd">        The function returned by ``predicate`` is **always** a coroutine,</span>
<span class="sd">        even if the original function was not a coroutine.</span>

<span class="sd">    .. versionchanged:: 1.3</span>
<span class="sd">        The ``predicate`` attribute was added.</span>

<span class="sd">    Examples</span>
<span class="sd">    ---------</span>

<span class="sd">    Creating a basic check to see if the command invoker is you.</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        def check_if_it_is_me(ctx):</span>
<span class="sd">            return ctx.message.author.id == 85309593344815104</span>

<span class="sd">        @bot.command()</span>
<span class="sd">        @commands.check(check_if_it_is_me)</span>
<span class="sd">        async def only_for_me(ctx):</span>
<span class="sd">            await ctx.send(&#39;I know you!&#39;)</span>

<span class="sd">    Transforming common checks into its own decorator:</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        def is_me():</span>
<span class="sd">            def predicate(ctx):</span>
<span class="sd">                return ctx.message.author.id == 85309593344815104</span>
<span class="sd">            return commands.check(predicate)</span>

<span class="sd">        @bot.command()</span>
<span class="sd">        @is_me()</span>
<span class="sd">        async def only_me(ctx):</span>
<span class="sd">            await ctx.send(&#39;Only you!&#39;)</span>

<span class="sd">    .. versionchanged:: 2.0</span>

<span class="sd">        ``predicate`` parameter is now positional-only.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    predicate: Callable[[:class:`Context`], :class:`bool`]</span>
<span class="sd">        The predicate to check if the command should be invoked.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__commands_checks__&#39;</span><span class="p">):</span>
                <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span>

    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">predicate</span><span class="p">):</span>
        <span class="n">decorator</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">ContextT</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">decorator</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">check_any</span><span class="p">(</span><span class="o">*</span><span class="n">checks</span><span class="p">:</span> <span class="n">Check</span><span class="p">[</span><span class="n">ContextT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">ContextT</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A :func:`check` that is added that checks if any of the checks passed</span>
<span class="sd">    will pass, i.e. using logical OR.</span>

<span class="sd">    If all checks fail then :exc:`.CheckAnyFailure` is raised to signal the failure.</span>
<span class="sd">    It inherits from :exc:`.CheckFailure`.</span>

<span class="sd">    .. note::</span>

<span class="sd">        The ``predicate`` attribute for this function **is** a coroutine.</span>

<span class="sd">    .. versionadded:: 1.3</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    \*checks: Callable[[:class:`Context`], :class:`bool`]</span>
<span class="sd">        An argument list of checks that have been decorated with</span>
<span class="sd">        the :func:`check` decorator.</span>

<span class="sd">    Raises</span>
<span class="sd">    -------</span>
<span class="sd">    TypeError</span>
<span class="sd">        A check passed has not been decorated with the :func:`check`</span>
<span class="sd">        decorator.</span>

<span class="sd">    Examples</span>
<span class="sd">    ---------</span>

<span class="sd">    Creating a basic check to see if it&#39;s the bot owner or</span>
<span class="sd">    the server owner:</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        def is_guild_owner():</span>
<span class="sd">            def predicate(ctx):</span>
<span class="sd">                return ctx.guild is not None and ctx.guild.owner_id == ctx.author.id</span>
<span class="sd">            return commands.check(predicate)</span>

<span class="sd">        @bot.command()</span>
<span class="sd">        @commands.check_any(commands.is_owner(), is_guild_owner())</span>
<span class="sd">        async def only_for_owners(ctx):</span>
<span class="sd">            await ctx.send(&#39;Hello mister owner!&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">unwrapped</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">wrapped</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">wrapped</span><span class="o">.</span><span class="n">predicate</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wrapped</span><span class="si">!r}</span><span class="s1"> must be wrapped by commands.check decorator&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unwrapped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">unwrapped</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">CheckFailure</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># if we&#39;re here, all checks failed</span>
        <span class="k">raise</span> <span class="n">CheckAnyFailure</span><span class="p">(</span><span class="n">unwrapped</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">has_role</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :func:`.check` that is added that checks if the member invoking the</span>
<span class="sd">    command has the role specified via the name or ID specified.</span>

<span class="sd">    If a string is specified, you must give the exact name of the role, including</span>
<span class="sd">    caps and spelling.</span>

<span class="sd">    If an integer is specified, you must give the exact snowflake ID of the role.</span>

<span class="sd">    If the message is invoked in a private message context then the check will</span>
<span class="sd">    return ``False``.</span>

<span class="sd">    This check raises one of two special exceptions, :exc:`.MissingRole` if the user</span>
<span class="sd">    is missing a role, or :exc:`.NoPrivateMessage` if it is used in a private message.</span>
<span class="sd">    Both inherit from :exc:`.CheckFailure`.</span>

<span class="sd">    .. versionchanged:: 1.1</span>

<span class="sd">        Raise :exc:`.MissingRole` or :exc:`.NoPrivateMessage`</span>
<span class="sd">        instead of generic :exc:`.CheckFailure`</span>

<span class="sd">    .. versionchanged:: 2.0</span>

<span class="sd">        ``item`` parameter is now positional-only.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    item: Union[:class:`int`, :class:`str`]</span>
<span class="sd">        The name or ID of the role to check.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span><span class="p">()</span>

        <span class="c1"># ctx.guild is None doesn&#39;t narrow ctx.author to Member</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">get_role</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">roles</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingRole</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">has_any_role</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A :func:`.check` that is added that checks if the member invoking the</span>
<span class="sd">    command has **any** of the roles specified. This means that if they have</span>
<span class="sd">    one out of the three roles specified, then this check will return ``True``.</span>

<span class="sd">    Similar to :func:`.has_role`\, the names or IDs passed in must be exact.</span>

<span class="sd">    This check raises one of two special exceptions, :exc:`.MissingAnyRole` if the user</span>
<span class="sd">    is missing all roles, or :exc:`.NoPrivateMessage` if it is used in a private message.</span>
<span class="sd">    Both inherit from :exc:`.CheckFailure`.</span>

<span class="sd">    .. versionchanged:: 1.1</span>

<span class="sd">        Raise :exc:`.MissingAnyRole` or :exc:`.NoPrivateMessage`</span>
<span class="sd">        instead of generic :exc:`.CheckFailure`</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    items: List[Union[:class:`str`, :class:`int`]]</span>
<span class="sd">        An argument list of names or IDs to check that the member has roles wise.</span>

<span class="sd">    Example</span>
<span class="sd">    --------</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        @bot.command()</span>
<span class="sd">        @commands.has_any_role(&#39;Library Devs&#39;, &#39;Moderators&#39;, 492212595072434186)</span>
<span class="sd">        async def cool(ctx):</span>
<span class="sd">            await ctx.send(&#39;You are cool indeed&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span><span class="p">()</span>

        <span class="c1"># ctx.guild is None doesn&#39;t narrow ctx.author to Member</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">get_role</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">roles</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">raise</span> <span class="n">MissingAnyRole</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">bot_has_role</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Similar to :func:`.has_role` except checks if the bot itself has the</span>
<span class="sd">    role.</span>

<span class="sd">    This check raises one of two special exceptions, :exc:`.BotMissingRole` if the bot</span>
<span class="sd">    is missing the role, or :exc:`.NoPrivateMessage` if it is used in a private message.</span>
<span class="sd">    Both inherit from :exc:`.CheckFailure`.</span>

<span class="sd">    .. versionchanged:: 1.1</span>

<span class="sd">        Raise :exc:`.BotMissingRole` or :exc:`.NoPrivateMessage`</span>
<span class="sd">        instead of generic :exc:`.CheckFailure`</span>

<span class="sd">    .. versionchanged:: 2.0</span>

<span class="sd">        ``item`` parameter is now positional-only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">get_role</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">roles</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BotMissingRole</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">bot_has_any_role</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Similar to :func:`.has_any_role` except checks if the bot itself has</span>
<span class="sd">    any of the roles listed.</span>

<span class="sd">    This check raises one of two special exceptions, :exc:`.BotMissingAnyRole` if the bot</span>
<span class="sd">    is missing all roles, or :exc:`.NoPrivateMessage` if it is used in a private message.</span>
<span class="sd">    Both inherit from :exc:`.CheckFailure`.</span>

<span class="sd">    .. versionchanged:: 1.1</span>

<span class="sd">        Raise :exc:`.BotMissingAnyRole` or :exc:`.NoPrivateMessage`</span>
<span class="sd">        instead of generic checkfailure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span><span class="p">()</span>

        <span class="n">me</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">me</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">me</span><span class="o">.</span><span class="n">get_role</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">discord</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">.</span><span class="n">roles</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">raise</span> <span class="n">BotMissingAnyRole</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">has_permissions</span><span class="p">(</span><span class="o">**</span><span class="n">perms</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :func:`.check` that is added that checks if the member has all of</span>
<span class="sd">    the permissions necessary.</span>

<span class="sd">    Note that this check operates on the current channel permissions, not the</span>
<span class="sd">    guild wide permissions.</span>

<span class="sd">    The permissions passed in must be exactly like the properties shown under</span>
<span class="sd">    :class:`.discord.Permissions`.</span>

<span class="sd">    This check raises a special exception, :exc:`.MissingPermissions`</span>
<span class="sd">    that is inherited from :exc:`.CheckFailure`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    perms</span>
<span class="sd">        An argument list of permissions to check for.</span>

<span class="sd">    Example</span>
<span class="sd">    ---------</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        @bot.command()</span>
<span class="sd">        @commands.has_permissions(manage_messages=True)</span>
<span class="sd">        async def test(ctx):</span>
<span class="sd">            await ctx.send(&#39;You can manage messages.&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">invalid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">discord</span><span class="o">.</span><span class="n">Permissions</span><span class="o">.</span><span class="n">VALID_FLAGS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid permission(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">permissions</span>

        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">perm</span> <span class="k">for</span> <span class="n">perm</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">perms</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">raise</span> <span class="n">MissingPermissions</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">bot_has_permissions</span><span class="p">(</span><span class="o">**</span><span class="n">perms</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Similar to :func:`.has_permissions` except checks if the bot itself has</span>
<span class="sd">    the permissions listed.</span>

<span class="sd">    This check raises a special exception, :exc:`.BotMissingPermissions`</span>
<span class="sd">    that is inherited from :exc:`.CheckFailure`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">invalid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">discord</span><span class="o">.</span><span class="n">Permissions</span><span class="o">.</span><span class="n">VALID_FLAGS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid permission(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">bot_permissions</span>

        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">perm</span> <span class="k">for</span> <span class="n">perm</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">perms</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">raise</span> <span class="n">BotMissingPermissions</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">has_guild_permissions</span><span class="p">(</span><span class="o">**</span><span class="n">perms</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Similar to :func:`.has_permissions`, but operates on guild wide</span>
<span class="sd">    permissions instead of the current channel permissions.</span>

<span class="sd">    If this check is called in a DM context, it will raise an</span>
<span class="sd">    exception, :exc:`.NoPrivateMessage`.</span>

<span class="sd">    .. versionadded:: 1.3</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">invalid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">discord</span><span class="o">.</span><span class="n">Permissions</span><span class="o">.</span><span class="n">VALID_FLAGS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid permission(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span>

        <span class="n">permissions</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">guild_permissions</span>  <span class="c1"># type: ignore</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">perm</span> <span class="k">for</span> <span class="n">perm</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">perms</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">raise</span> <span class="n">MissingPermissions</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">bot_has_guild_permissions</span><span class="p">(</span><span class="o">**</span><span class="n">perms</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Similar to :func:`.has_guild_permissions`, but checks the bot</span>
<span class="sd">    members guild permissions.</span>

<span class="sd">    .. versionadded:: 1.3</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">invalid</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">discord</span><span class="o">.</span><span class="n">Permissions</span><span class="o">.</span><span class="n">VALID_FLAGS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid permission(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span>

        <span class="n">permissions</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">guild_permissions</span>  <span class="c1"># type: ignore</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">perm</span> <span class="k">for</span> <span class="n">perm</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">perms</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">raise</span> <span class="n">BotMissingPermissions</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">dm_only</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :func:`.check` that indicates this command must only be used in a</span>
<span class="sd">    DM context. Only private messages are allowed when</span>
<span class="sd">    using the command.</span>

<span class="sd">    This check raises a special exception, :exc:`.PrivateMessageOnly`</span>
<span class="sd">    that is inherited from :exc:`.CheckFailure`.</span>

<span class="sd">    .. versionadded:: 1.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrivateMessageOnly</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">guild_only</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :func:`.check` that indicates this command must only be used in a</span>
<span class="sd">    guild context only. Basically, no private messages are allowed when</span>
<span class="sd">    using the command.</span>

<span class="sd">    This check raises a special exception, :exc:`.NoPrivateMessage`</span>
<span class="sd">    that is inherited from :exc:`.CheckFailure`.</span>

<span class="sd">    If used on hybrid commands, this will be equivalent to the</span>
<span class="sd">    :func:`discord.app_commands.guild_only` decorator. In an unsupported</span>
<span class="sd">    context, such as a subcommand, this will still fallback to applying the</span>
<span class="sd">    check.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Due to implementation quirks, this check has to be re-implemented completely</span>
    <span class="c1"># to work with both app_commands and the command framework.</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoPrivateMessage</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__commands_is_hybrid__&#39;</span><span class="p">):</span>
                <span class="n">app_command</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;app_command&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">app_command</span><span class="p">:</span>
                    <span class="n">app_command</span><span class="o">.</span><span class="n">guild_only</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__commands_checks__&#39;</span><span class="p">):</span>
                <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__discord_app_commands_guild_only__</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">func</span>

    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">predicate</span><span class="p">):</span>
        <span class="n">decorator</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">decorator</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">is_owner</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :func:`.check` that checks if the person invoking this command is the</span>
<span class="sd">    owner of the bot.</span>

<span class="sd">    This is powered by :meth:`.Bot.is_owner`.</span>

<span class="sd">    This check raises a special exception, :exc:`.NotOwner` that is derived</span>
<span class="sd">    from :exc:`.CheckFailure`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">is_owner</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">author</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NotOwner</span><span class="p">(</span><span class="s1">&#39;You do not own this bot.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_nsfw</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Check</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A :func:`.check` that checks if the channel is a NSFW channel.</span>

<span class="sd">    This check raises a special exception, :exc:`.NSFWChannelRequired`</span>
<span class="sd">    that is derived from :exc:`.CheckFailure`.</span>

<span class="sd">    If used on hybrid commands, this will be equivalent to setting the</span>
<span class="sd">    application command&#39;s ``nsfw`` attribute to ``True``. In an unsupported</span>
<span class="sd">    context, such as a subcommand, this will still fallback to applying the</span>
<span class="sd">    check.</span>

<span class="sd">    .. versionchanged:: 1.1</span>

<span class="sd">        Raise :exc:`.NSFWChannelRequired` instead of generic :exc:`.CheckFailure`.</span>
<span class="sd">        DM channels will also now pass this check.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Due to implementation quirks, this check has to be re-implemented completely</span>
    <span class="c1"># to work with both app_commands and the command framework.</span>

    <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">channel</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">guild</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="p">(</span><span class="n">discord</span><span class="o">.</span><span class="n">TextChannel</span><span class="p">,</span> <span class="n">discord</span><span class="o">.</span><span class="n">Thread</span><span class="p">,</span> <span class="n">discord</span><span class="o">.</span><span class="n">VoiceChannel</span><span class="p">))</span> <span class="ow">and</span> <span class="n">ch</span><span class="o">.</span><span class="n">is_nsfw</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">raise</span> <span class="n">NSFWChannelRequired</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__commands_is_hybrid__&#39;</span><span class="p">):</span>
                <span class="n">app_command</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;app_command&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">app_command</span><span class="p">:</span>
                    <span class="n">app_command</span><span class="o">.</span><span class="n">nsfw</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="s1">&#39;__commands_checks__&#39;</span><span class="p">):</span>
                <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">func</span><span class="o">.</span><span class="n">__commands_checks__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__discord_app_commands_is_nsfw__</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">func</span>

    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">predicate</span><span class="p">):</span>
        <span class="n">decorator</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">[</span><span class="n">BotT</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">predicate</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">decorator</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">cooldown</span><span class="p">(</span>
    <span class="n">rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">per</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BucketType</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">BucketType</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that adds a cooldown to a :class:`.Command`</span>

<span class="sd">    A cooldown allows a command to only be used a specific amount</span>
<span class="sd">    of times in a specific time frame. These cooldowns can be based</span>
<span class="sd">    either on a per-guild, per-channel, per-user, per-role or global basis.</span>
<span class="sd">    Denoted by the third argument of ``type`` which must be of enum</span>
<span class="sd">    type :class:`.BucketType`.</span>

<span class="sd">    If a cooldown is triggered, then :exc:`.CommandOnCooldown` is triggered in</span>
<span class="sd">    :func:`.on_command_error` and the local error handler.</span>

<span class="sd">    A command can only have a single cooldown.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    rate: :class:`int`</span>
<span class="sd">        The number of times a command can be used before triggering a cooldown.</span>
<span class="sd">    per: :class:`float`</span>
<span class="sd">        The amount of seconds to wait for a cooldown when it&#39;s been triggered.</span>
<span class="sd">    type: Union[:class:`.BucketType`, Callable[[:class:`.Context`], Any]]</span>
<span class="sd">        The type of cooldown to have. If callable, should return a key for the mapping.</span>

<span class="sd">        .. versionchanged:: 1.7</span>
<span class="sd">            Callables are now supported for custom bucket types.</span>

<span class="sd">        .. versionchanged:: 2.0</span>
<span class="sd">            When passing a callable, it now needs to accept :class:`.Context`</span>
<span class="sd">            rather than :class:`~discord.Message` as its only argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">_buckets</span> <span class="o">=</span> <span class="n">CooldownMapping</span><span class="p">(</span><span class="n">Cooldown</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">per</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__commands_cooldown__</span> <span class="o">=</span> <span class="n">CooldownMapping</span><span class="p">(</span><span class="n">Cooldown</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">per</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">dynamic_cooldown</span><span class="p">(</span>
    <span class="n">cooldown</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Cooldown</span><span class="p">]],</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BucketType</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">Any</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that adds a dynamic cooldown to a :class:`.Command`</span>

<span class="sd">    This differs from :func:`.cooldown` in that it takes a function that</span>
<span class="sd">    accepts a single parameter of type :class:`.Context` and must</span>
<span class="sd">    return a :class:`~discord.app_commands.Cooldown` or ``None``.</span>
<span class="sd">    If ``None`` is returned then that cooldown is effectively bypassed.</span>

<span class="sd">    A cooldown allows a command to only be used a specific amount</span>
<span class="sd">    of times in a specific time frame. These cooldowns can be based</span>
<span class="sd">    either on a per-guild, per-channel, per-user, per-role or global basis.</span>
<span class="sd">    Denoted by the third argument of ``type`` which must be of enum</span>
<span class="sd">    type :class:`.BucketType`.</span>

<span class="sd">    If a cooldown is triggered, then :exc:`.CommandOnCooldown` is triggered in</span>
<span class="sd">    :func:`.on_command_error` and the local error handler.</span>

<span class="sd">    A command can only have a single cooldown.</span>

<span class="sd">    .. versionadded:: 2.0</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    cooldown: Callable[[:class:`.Context`], Optional[:class:`~discord.app_commands.Cooldown`]]</span>
<span class="sd">        A function that takes a message and returns a cooldown that will</span>
<span class="sd">        apply to this invocation or ``None`` if the cooldown should be bypassed.</span>
<span class="sd">    type: :class:`.BucketType`</span>
<span class="sd">        The type of cooldown to have.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">cooldown</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;A callable must be provided&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="n">BucketType</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;BucketType.default cannot be used in dynamic cooldowns&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">_buckets</span> <span class="o">=</span> <span class="n">DynamicCooldownMapping</span><span class="p">(</span><span class="n">cooldown</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__commands_cooldown__</span> <span class="o">=</span> <span class="n">DynamicCooldownMapping</span><span class="p">(</span><span class="n">cooldown</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">max_concurrency</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">per</span><span class="p">:</span> <span class="n">BucketType</span> <span class="o">=</span> <span class="n">BucketType</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that adds a maximum concurrency to a :class:`.Command` or its subclasses.</span>

<span class="sd">    This enables you to only allow a certain number of command invocations at the same time,</span>
<span class="sd">    for example if a command takes too long or if only one user can use it at a time. This</span>
<span class="sd">    differs from a cooldown in that there is no set waiting period or token bucket -- only</span>
<span class="sd">    a set number of people can run the command.</span>

<span class="sd">    .. versionadded:: 1.3</span>

<span class="sd">    Parameters</span>
<span class="sd">    -------------</span>
<span class="sd">    number: :class:`int`</span>
<span class="sd">        The maximum number of invocations of this command that can be running at the same time.</span>
<span class="sd">    per: :class:`.BucketType`</span>
<span class="sd">        The bucket that this concurrency is based on, e.g. ``BucketType.guild`` would allow</span>
<span class="sd">        it to be used up to ``number`` times per guild.</span>
<span class="sd">    wait: :class:`bool`</span>
<span class="sd">        Whether the command should wait for the queue to be over. If this is set to ``False``</span>
<span class="sd">        then instead of waiting until the command can run again, the command raises</span>
<span class="sd">        :exc:`.MaxConcurrencyReached` to its error handler. If this is set to ``True``</span>
<span class="sd">        then the command waits until it can be executed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">MaxConcurrency</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">per</span><span class="o">=</span><span class="n">per</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">_max_concurrency</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__commands_max_concurrency__</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">before_invoke</span><span class="p">(</span><span class="n">coro</span><span class="p">:</span> <span class="n">Hook</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that registers a coroutine as a pre-invoke hook.</span>

<span class="sd">    This allows you to refer to one before invoke hook for several commands that</span>
<span class="sd">    do not have to be within the same cog.</span>

<span class="sd">    .. versionadded:: 1.4</span>

<span class="sd">    .. versionchanged:: 2.0</span>

<span class="sd">        ``coro`` parameter is now positional-only.</span>

<span class="sd">    Example</span>
<span class="sd">    ---------</span>

<span class="sd">    .. code-block:: python3</span>

<span class="sd">        async def record_usage(ctx):</span>
<span class="sd">            print(ctx.author, &#39;used&#39;, ctx.command, &#39;at&#39;, ctx.message.created_at)</span>

<span class="sd">        @bot.command()</span>
<span class="sd">        @commands.before_invoke(record_usage)</span>
<span class="sd">        async def who(ctx): # Output: &lt;User&gt; used who at &lt;Time&gt;</span>
<span class="sd">            await ctx.send(&#39;i am a bot&#39;)</span>

<span class="sd">        class What(commands.Cog):</span>

<span class="sd">            @commands.before_invoke(record_usage)</span>
<span class="sd">            @commands.command()</span>
<span class="sd">            async def when(self, ctx): # Output: &lt;User&gt; used when at &lt;Time&gt;</span>
<span class="sd">                await ctx.send(f&#39;and i have existed since {ctx.bot.user.created_at}&#39;)</span>

<span class="sd">            @commands.command()</span>
<span class="sd">            async def where(self, ctx): # Output: &lt;Nothing&gt;</span>
<span class="sd">                await ctx.send(&#39;on Discord&#39;)</span>

<span class="sd">            @commands.command()</span>
<span class="sd">            async def why(self, ctx): # Output: &lt;Nothing&gt;</span>
<span class="sd">                await ctx.send(&#39;because someone made me&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">before_invoke</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__before_invoke__</span> <span class="o">=</span> <span class="n">coro</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>


<span class="k">def</span> <span class="nf">after_invoke</span><span class="p">(</span><span class="n">coro</span><span class="p">:</span> <span class="n">Hook</span><span class="p">[</span><span class="n">CogT</span><span class="p">,</span> <span class="n">ContextT</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A decorator that registers a coroutine as a post-invoke hook.</span>

<span class="sd">    This allows you to refer to one after invoke hook for several commands that</span>
<span class="sd">    do not have to be within the same cog.</span>

<span class="sd">    .. versionadded:: 1.4</span>

<span class="sd">    .. versionchanged:: 2.0</span>

<span class="sd">        ``coro`` parameter is now positional-only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Command</span><span class="p">,</span> <span class="n">CoroFunc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Command</span><span class="p">):</span>
            <span class="n">func</span><span class="o">.</span><span class="n">after_invoke</span><span class="p">(</span><span class="n">coro</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="n">__after_invoke__</span> <span class="o">=</span> <span class="n">coro</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span>  <span class="c1"># type: ignore</span>
</pre></div>

           </div>
          </div>
<a href="https://github.com/Cog-Creators/StarBot">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
    src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149"
    class="attachment-full size-full" alt="Fork me on GitHub">
</a>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2024, Cog Creators.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>